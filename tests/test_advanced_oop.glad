PRINTLN "--- Advanced OOP & Closure Test ---"

# This function creates a 'greeter' function
DEF create_greeter(greeting)
  DEF greeter_func(name)
    RETURN greeting + ", " + name + "!"
  ENDDEF
  RETURN greeter_func
ENDDEF

PRINTLN "Creating greeter functions..."
LET say_hello = create_greeter("Hello")
LET say_hi = create_greeter("Hi")

# Create a class that holds a function
CLASS Person
  DEF Person(name, greeter_func)
    THIS.name = name
    THIS.greeter = greeter_func # Store the function as an attribute
  ENDDEF
  
  DEF greet()
    # Call the stored function, passing in our name
    LET message = THIS.greeter(THIS.name)
    PRINTLN message
  ENDDEF
ENDCLASS

PRINTLN "--- Creating people ---"
LET alex = NEW Person("Alex", say_hello)
LET bob = NEW Person("Bob", say_hi)

PRINTLN "--- Testing method calls ---"
alex.greet() # Should print "Hello, Alex!"
bob.greet()  # Should print "Hi, Bob!"

# --- Re-assigning an attribute ---
PRINTLN "--- Re-assigning attribute ---"
alex.greeter = say_hi # Change Alex's greeter function
alex.greet() # Should now print "Hi, Alex!"